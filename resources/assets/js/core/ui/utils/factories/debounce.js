/**
 * @namespace dias.ui.utils
 * @ngdoc factory
 * @name debounce
 * @memberOf dias.ui.utils
 * @description A debounce service to perform an action only when this function
 * wasn't called again in a short period of time.
 * see http://stackoverflow.com/a/13320016/1796523
 */
angular.module('dias.ui.utils').factory('debounce', function ($timeout, $q) {
      "use strict";

      var timeouts = {};

      return function (func, wait, id) {
         // Create a deferred object that will be resolved when we need to
         // actually call the func
         var deferred = $q.defer();
         return (function() {
            var context = this, args = arguments;
            var later = function() {
               timeouts[id] = undefined;
               deferred.resolve(func.apply(context, args));
               deferred = $q.defer();
            };
            if (timeouts[id]) {
               $timeout.cancel(timeouts[id]);
            }
            timeouts[id] = $timeout(later, wait);
            return deferred.promise;
         })();
      };
   }
);
