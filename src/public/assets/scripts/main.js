biigle.$viewModel("volume-dashboard-hot-box-right",function(e){new Vue({el:e,components:{volumeThumbnail:biigle.$require("projects.components.volumeThumbnail")}})}),biigle.$viewModel("volume-metadata-upload",function(e){var t=biigle.$require("messages.store"),i=biigle.$require("api.volumeImageMetadata"),s=biigle.$require("volumes.id");new Vue({el:e,data:{loading:!1,csv:void 0,error:!1,success:!1,message:void 0},methods:{handleSuccess:function(){this.error=!1,this.success=!0},handleError:function(e){this.success=!1,e.data.file?Array.isArray(e.data.file)?this.error=e.data.file[0]:this.error=e.data.file:t.handleErrorResponse(e)},submit:function(e){if(this.csv){this.loading=!0;var t=new FormData;t.append("file",this.csv),i.save({id:s},t).bind(this).then(this.handleSuccess,this.handleError).finally(function(){this.loading=!1})}},setCsv:function(e){this.csv=e.target.files[0]}}})}),biigle.$viewModel("volume-container",function(e){var t=(biigle.$require("volumes.volumeId"),biigle.$require("volumes.imageIds")),i=biigle.$require("volumes.imageUuids"),s=biigle.$require("volumes.thumbUri"),o=biigle.$require("volumes.annotateUri"),n=biigle.$require("volumes.imageUri");new Vue({el:e,components:{imageGrid:biigle.$require("volumes.components.volumeImageGrid")},data:{imageIds:t},computed:{images:function(){return this.imageIds.map(function(e){return{id:e,url:s.replace("{uuid}",i[e]),annotateUrl:o.replace("{id}",e),imageUrl:n.replace("{id}",e)}})},imagesToShow:function(){return this.images}},methods:{}})}),biigle.$declare("api.volumeImageMetadata",Vue.resource("api/v1/volumes{/id}/images/metadata")),biigle.$component("volumes.components.imageGrid",{template:'<div class="image-grid" @wheel.prevent="scroll"><div class="image-grid__images" ref="images"><image-grid-image v-for="image in displayedImages" :key="image.id" :image="image" :empty-url="emptyUrl" @select="emitSelect" @deselect="emitDeselect"></image-grid-image></div><image-grid-progress :progress="progress" @top="jumpToStart" @prev-page="reversePage" @prev-row="reverseRow" @jump="jumpToPercent" @next-row="advanceRow" @next-page="advancePage" @bottom="jumpToEnd"></image-grid-progress></div>',data:function(){return{clientWidth:0,clientHeight:0,privateOffset:0}},components:{imageGridImage:biigle.$require("volumes.components.imageGridImage"),imageGridProgress:biigle.$require("volumes.components.imageGridProgress")},props:{images:{type:Array,required:!0},emptyUrl:{type:String,required:!0},width:{type:Number,default:135},height:{type:Number,default:180},margin:{type:Number,default:8}},computed:{columns:function(){return Math.floor(this.clientWidth/(this.width+this.margin))},rows:function(){return Math.floor(this.clientHeight/(this.height+this.margin))},displayedImages:function(){return this.images.slice(this.offset,this.offset+this.columns*this.rows)},offset:{get:function(){return this.privateOffset},set:function(e){this.privateOffset=Math.max(0,Math.min(this.lastRow*this.columns,e))}},progress:function(){return this.offset/(this.columns*this.lastRow)},lastRow:function(){return Math.ceil(this.images.length/this.columns)-this.rows}},methods:{updateDimensions:function(){this.clientHeight=this.$refs.images.clientHeight,this.clientWidth=this.$refs.images.clientWidth,this.offset=this.offset},scrollRows:function(e){this.offset=this.offset+this.columns*e},scroll:function(e){this.scrollRows(e.deltaY>=0?1:-1)},advanceRow:function(){this.scrollRows(1)},advancePage:function(){this.scrollRows(this.rows)},reverseRow:function(){this.scrollRows(-1)},reversePage:function(){this.scrollRows(-this.rows)},jumpToPercent:function(e){this.offset=this.columns*Math.round(this.lastRow*e)},jumpToStart:function(){this.jumpToPercent(0)},jumpToEnd:function(){this.jumpToPercent(1)},emitSelect:function(e){this.$emit("select",e)},emitDeselect:function(e){this.$emit("deselect",e)}},created:function(){window.addEventListener("resize",this.updateDimensions);var e=biigle.$require("labelTrees.stores.keyboard");e.on(38,this.reverseRow),e.on(40,this.advanceRow),e.on(37,this.reversePage),e.on(33,this.reversePage),e.on(39,this.advancePage),e.on(34,this.advancePage),e.on(36,this.jumpToStart),e.on(35,this.jumpToEnd)},mounted:function(){this.$nextTick(this.updateDimensions)}}),biigle.$component("volumes.components.imageGridImage",{template:'<figure class="image-grid__image" :class="classObject"><img @click="toggleSelect" :src="url || emptyUrl" @error="showEmptyImage"></figure>',data:function(){return{url:"",timeout:null}},props:{image:{type:Object,required:!0},emptyUrl:{type:String,required:!0}},computed:{classObject:function(){return{"image-grid__image--selected":this.selected}},selected:function(){return!1}},methods:{toggleSelect:function(){this.selected?this.$emit("deselect",this.image):this.$emit("select",this.image)},gotBlob:function(e){var t=window.URL||window.webkitURL;this.url=t.createObjectURL(e.body),this.image.blob=this.url},showEmptyImage:function(){this.url=this.emptyUrl}},created:function(){if(this.image.url)this.url=this.image.url;else if(this.image.blob)this.url=this.image.blob;else if(this.getUrl)this.url=this.getUrl();else if(this.getBlob){var e=this;this.timeout=setTimeout(function(){e.getBlob().then(e.gotBlob)},50)}},beforeDestroy:function(){clearTimeout(this.timeout)}}),biigle.$component("volumes.components.imageGridProgress",{template:'<div class="image-grid-progress"><div class="btn-group-vertical"><button type="button" class="btn btn-default btn-xs" title="Go to top 𝗛𝗼𝗺𝗲" @click="top" :disabled="isAtTop"><span class="glyphicon glyphicon-fast-backward"></span></button><button type="button" class="btn btn-default btn-xs" title="Previous page 𝗣𝗮𝗴𝗲 𝘂𝗽/𝗔𝗿𝗿𝗼𝘄 𝗹𝗲𝗳𝘁" @click="prevPage" :disabled="isAtTop"><span class="glyphicon glyphicon-step-backward"></span></button><button type="button" class="btn btn-default btn-xs" title="Previous row 𝗔𝗿𝗿𝗼𝘄 𝘂𝗽" @click="prevRow" :disabled="isAtTop"><span class="glyphicon glyphicon-triangle-left"></span></button></div><div class="image-grid-progress__bar" @mousedown="beginScrolling" @mouseup="stopScrolling" @mouseleave="stopScrolling" @mousemove.prevent="scroll" @click="jump"><div class="image-grid-progress__wrapper"><div class="image-grid-progress__inner" :style="{height: progressHeight}"></div></div></div><div class="btn-group-vertical"><button type="button" class="btn btn-default btn-xs" title="Next row 𝗔𝗿𝗿𝗼𝘄 𝗱𝗼𝘄𝗻" @click="nextRow" :disabled="isAtBottom"><span class="glyphicon glyphicon-triangle-right"></span></button><button type="button" class="btn btn-default btn-xs" title="Next page 𝗣𝗮𝗴𝗲 𝗱𝗼𝘄𝗻/𝗔𝗿𝗿𝗼𝘄 𝗿𝗶𝗴𝗵𝘁" @click="nextPage" :disabled="isAtBottom"><span class="glyphicon glyphicon-step-forward"></span></button><button type="button" class="btn btn-default btn-xs" title="Go to bottom 𝗘𝗻𝗱" @click="bottom" :disabled="isAtBottom"><span class="glyphicon glyphicon-fast-forward"></span></button></div></div>',data:function(){return{scrolling:!1}},props:{progress:{type:Number,required:!0}},computed:{isAtTop:function(){return 0===this.progress},isAtBottom:function(){return 1===this.progress},progressHeight:function(){return 100*this.progress+"%"}},methods:{top:function(){this.$emit("top")},prevPage:function(){this.$emit("prev-page")},prevRow:function(){this.$emit("prev-row")},beginScrolling:function(){this.scrolling=!0},stopScrolling:function(){this.scrolling=!1},scroll:function(e){this.scrolling&&this.jump(e)},jump:function(e){var t=e.target.getBoundingClientRect();this.$emit("jump",(e.clientY-t.top)/t.height)},nextRow:function(){this.$emit("next-row")},nextPage:function(){this.$emit("next-page")},bottom:function(){this.$emit("bottom")}}}),biigle.$component("volumes.components.volumeImageGrid",{mixins:[biigle.$require("volumes.components.imageGrid")],components:{imageGridImage:biigle.$require("volumes.components.volumeImageGridImage")}}),biigle.$component("volumes.components.volumeImageGridImage",{mixins:[biigle.$require("volumes.components.imageGridImage")],template:'<figure class="image-grid__image"><a v-if="image.annotateUrl" :href="image.annotateUrl"><img @click="toggleSelect" :src="url || emptyUrl" @error="showEmptyImage"></a><img v-else @click="toggleSelect" :src="url || emptyUrl" @error="showEmptyImage"><div class="image-buttons"><a v-if="image.imageUrl" :href="image.imageUrl" class="image-button" title="Viev image information"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span></a></div></figure>',computed:{showAnnotationLink:function(){var e=biigle.$require("largo.showAnnotationRoute");return e?e+this.image.id:""},selected:function(){return this.image.dismissed},title:function(){return this.selected?"Undo dismissing this annotation":"Dismiss this annotation"}},methods:{getBlob:function(){return biigle.$require("largo.api.annotations").get({id:this.image.id})}}});