angular.module("biigle.projects",["biigle.api","biigle.ui"]),angular.module("biigle.projects").controller("MembersController",["$scope","PROJECT","MEMBERS","ROLES","DEFAULT_ROLE_ID","USER_ID","ProjectUser","msg","User",function(e,n,r,t,i,o,c,u,d){"use strict";var l=!1,s=!1;e.newMember={user:null,project_role_id:i.toString()};var a=function(e){u.responseError(e),s=!1},f=function(e){e.project_role_id=parseInt(e.tmp_project_role_id),s=!1},p=function(e,n){e.tmp_project_role_id=e.project_role_id.toString(),a(n)},m=function(e){for(var n=r.length-1;n>=0;n--)if(r[n].id===e.id){r.splice(n,1);break}s=!1},g=function(e){for(var n=r.length-1;n>=0;n--)if(r[n].id===e.id)return!1;return!0},_=function(e){return e.filter(g)},j=function(n){n.tmp_project_role_id=n.project_role_id.toString(),r.push(n),e.newMember.user=null,s=!1};e.isEditing=function(){return l},e.toggleEditing=function(){l=!l},e.isLoading=function(){return s},e.getMembers=function(){return r},e.hasMembers=function(){return r.length>0},e.getRoles=function(){return t},e.getRole=function(e){return t[e]},e.isOwnUser=function(e){return o===e.id},e.updateRole=function(e){s=!0,c.save({project_id:n.id},{id:e.id,project_role_id:parseInt(e.tmp_project_role_id)},function(){f(e)},function(n){p(e,n)})},e.detachMember=function(e){s||(s=!0,c.detach({project_id:n.id},{id:e.id},function(){m(e)},a))},e.username=function(e){return e&&e.firstname&&e.lastname?e.firstname+" "+e.lastname:""},e.findUser=function(e){return d.find({query:encodeURIComponent(e)}).$promise.then(_)},e.newMemberValid=function(){return e.newMember.user&&void 0!==e.newMember.user.id&&g(e.newMember.user)&&null!==e.newMember.project_role_id},e.attachMember=function(){if(!s&&e.newMemberValid()){s=!0;var r=e.newMember.user;r.project_role_id=parseInt(e.newMember.project_role_id),c.attach({project_id:n.id},{id:r.id,project_role_id:r.project_role_id},function(){j(r)},a)}};for(var b=r.length-1;b>=0;b--)r[b].tmp_project_role_id=r[b].project_role_id.toString()}]),angular.module("biigle.projects").controller("ProjectController",["$scope","PROJECT","Project","msg","$timeout","ProjectUser","USER_ID","REDIRECT_URL",function(e,n,r,t,i,o,c,u){"use strict";var d=!1,l=!1;e.projectInfo={name:n.name,description:n.description};var s=function(e){t.responseError(e),l=!1},a=function(e){n.name=e.name,n.description=e.description,d=!1,l=!1},f=function(){t.success("The project was deleted. Redirecting..."),i(function(){window.location.href=u},2e3)},p=function(){t.success("You left the project. Redirecting..."),i(function(){window.location.href=u},2e3)},m=function(e){400===e.status?confirm("Deleting this project will delete one or more transects with all annotations! Do you want to continue?")&&r.delete({id:n.id,force:!0},f,t.responseError):mgs.responseError(e)};e.isEditing=function(){return d},e.toggleEditing=function(){d=!d},e.isSaving=function(){return l},e.getName=function(){return n.name},e.getDescription=function(){return n.description},e.saveChanges=function(){l=!0,r.save({id:n.id,name:e.projectInfo.name,description:e.projectInfo.description},a,s)},e.discardChanges=function(){e.projectInfo.name=n.name,e.projectInfo.description=n.description,d=!1},e.deleteProject=function(){confirm("Do you really want to delete the project "+n.name+"?")&&r.delete({id:n.id},f,m)},e.leaveProject=function(){confirm("Do you really want to leave the project "+n.name+"?")&&o.detach({project_id:n.id},{id:c},p,t.responseError)}}]),angular.module("biigle.projects").controller("ProjectLabelTreesController",["$scope","PROJECT","LABEL_TREES","ProjectLabelTree","msg",function(e,n,r,t,i){"use strict";var o,c=!1,u=!1;e.selected={tree:null};var d=function(e){for(var n=r.length-1;n>=0;n--)if(r[n].id===e.id)return!1;return!0},l=function(n){r.push(n),e.selected.tree=null,u=!1},s=function(e){for(var n=r.length-1;n>=0;n--)if(r[n].id===e.id){r.splice(n,1);break}u=!1};e.isEditing=function(){return c},e.isLoading=function(){return u},e.toggleEditing=function(){c=!c,o||(o=t.available({project_id:n.id}))},e.getTrees=function(){return r},e.attachLabelTree=function(e){e&&void 0!==e.id&&d(e)&&(t.attach({project_id:n.id},{id:e.id},function(){l(e)},i.responseError),u=!0)},e.getAvailableTrees=function(){return o.filter(d)},e.detachLabelTree=function(e){t.detach({project_id:n.id},{id:e.id},s,i.responseError),u=!0}}]);