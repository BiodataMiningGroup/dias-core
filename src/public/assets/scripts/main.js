angular.module("dias.projects",["dias.api","dias.ui"]),angular.module("dias.projects").controller("MembersController",["$scope","PROJECT","MEMBERS","ROLES","DEFAULT_ROLE_ID","USER_ID","ProjectUser","msg","User",function(e,n,t,r,o,i,c,u,s){"use strict";var d=!1,a=!1;e.newMember={user:null,project_role_id:o.toString()};var l=function(e){u.responseError(e),a=!1},f=function(e){e.project_role_id=parseInt(e.tmp_project_role_id),a=!1},p=function(e,n){e.tmp_project_role_id=e.project_role_id.toString(),l(n)},g=function(e){for(var n=t.length-1;n>=0;n--)if(t[n].id===e.id){t.splice(n,1);break}a=!1},m=function(e){for(var n=t.length-1;n>=0;n--)if(t[n].id===e.id)return!1;return!0},_=function(e){return e.filter(m)},j=function(n){n.tmp_project_role_id=n.project_role_id.toString(),t.push(n),e.newMember.user=null,a=!1};e.isEditing=function(){return d},e.toggleEditing=function(){d=!d},e.isLoading=function(){return a},e.getMembers=function(){return t},e.hasMembers=function(){return t.length>0},e.getRoles=function(){return r},e.getRole=function(e){return r[e]},e.isOwnUser=function(e){return i===e.id},e.updateRole=function(e){a=!0,c.save({project_id:n.id},{id:e.id,project_role_id:parseInt(e.tmp_project_role_id)},function(){f(e)},function(n){p(e,n)})},e.detachMember=function(e){a=!0,c.detach({project_id:n.id},{id:e.id},function(){g(e)},l)},e.username=function(e){return e&&e.firstname&&e.lastname?e.firstname+" "+e.lastname:""},e.findUser=function(e){return s.find({query:encodeURIComponent(e)}).$promise.then(_)},e.newMemberValid=function(){return e.newMember.user&&void 0!==e.newMember.user.id&&m(e.newMember.user)&&null!==e.newMember.project_role_id},e.attachMember=function(){if(e.newMemberValid()){a=!0;var t=e.newMember.user;t.project_role_id=parseInt(e.newMember.project_role_id),c.attach({project_id:n.id},{id:t.id,project_role_id:t.project_role_id},function(){j(t)},l)}};for(var h=t.length-1;h>=0;h--)t[h].tmp_project_role_id=t[h].project_role_id.toString()}]),angular.module("dias.projects").controller("ProjectController",["$scope","PROJECT","Project","msg","$timeout","ProjectUser","USER_ID","REDIRECT_URL",function(e,n,t,r,o,i,c,u){"use strict";var s=!1,d=!1;e.projectInfo={name:n.name,description:n.description};var a=function(e){meg.responseError(e),d=!1},l=function(e){n.name=e.name,n.description=e.description,s=!1,d=!1},f=function(){r.success("The project was deleted. Redirecting..."),o(function(){window.location.href=u},2e3)},p=function(){r.success("You left the project. Redirecting..."),o(function(){window.location.href=u},2e3)},g=function(e){400===e.status?confirm("Deleting this project will delete one or more transects with all annotations! Do you want to continue?")&&t["delete"]({id:n.id,force:!0},f,r.responseError):mgs.responseError(e)};e.isEditing=function(){return s},e.toggleEditing=function(){s=!s},e.isSaving=function(){return d},e.getName=function(){return n.name},e.getDescription=function(){return n.description},e.saveChanges=function(){d=!0,t.save({id:n.id,name:e.projectInfo.name,description:e.projectInfo.description},l,a)},e.discardChanges=function(){e.projectInfo.name=n.name,e.projectInfo.description=n.description,s=!1},e.deleteProject=function(){confirm("Do you really want to delete the project "+n.name+"?")&&t["delete"]({id:n.id},f,g)},e.leaveProject=function(){confirm("Do you really want to leave the project "+n.name+"?")&&i.detach({project_id:n.id},{id:c},p,r.responseError)}}]),angular.module("dias.projects").controller("ProjectLabelTreesController",["$scope","PROJECT","LABEL_TREES","ProjectLabelTree","msg",function(e,n,t,r,o){"use strict";var i,c=!1,u=!1;e.selected={tree:null};var s=function(e){for(var n=t.length-1;n>=0;n--)if(t[n].id===e.id)return!1;return!0},d=function(n){t.push(n),e.selected.tree=null,u=!1},a=function(e){for(var n=t.length-1;n>=0;n--)if(t[n].id===e.id){t.splice(n,1);break}u=!1};e.isEditing=function(){return c},e.isLoading=function(){return u},e.toggleEditing=function(){c=!c,i||(i=r.available({project_id:n.id}))},e.getTrees=function(){return t},e.attachLabelTree=function(e){e&&void 0!==e.id&&s(e)&&(r.attach({project_id:n.id},{id:e.id},function(){d(e)},o.responseError),u=!0)},e.getAvailableTrees=function(){return i.filter(s)},e.detachLabelTree=function(e){r.detach({project_id:n.id},{id:e.id},a,o.responseError),u=!0}}]),angular.module("dias.projects").controller("TransectsController",["$scope","PROJECT","TRANSECTS","ProjectTransect","msg",function(e,n,t,r,o){"use strict";var i=!1,c=!1,u=function(e){o.responseError(e),c=!1},s=function(e,t){400===t.status?confirm("The transect you are about to remove belongs only to this project and will be deleted. Are you sure you want to delete this transect?")?r.detach({project_id:n.id,force:!0},{id:e.id},function(){d(e)},u):c=!1:u(t)},d=function(n){for(var r=t.length-1;r>=0;r--)if(t[r].id===n.id){t.splice(r,1);break}c=!1,e.hasTransects()||(i=!1)};e.isEditing=function(){return i},e.toggleEditing=function(){i=!i},e.isLoading=function(){return c},e.getTransects=function(){return t},e.hasTransects=function(){return t.length>0},e.detachTransect=function(e){c=!0,r.detach({project_id:n.id},{id:e.id},function(){d(e)},function(n){s(e,n)})}}]);