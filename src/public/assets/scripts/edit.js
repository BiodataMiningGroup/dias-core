angular.module("dias.transects.edit",["dias.api","dias.ui.messages"]),angular.module("dias.transects.edit").config(["$compileProvider",function(e){"use strict";e.debugInfoEnabled(!1)}]),angular.module("dias.transects.edit").controller("AnnotationSessionController",["$scope","AnnotationSession","TRANSECT_ID","ANNOTATION_SESSIONS","msg",function(e,n,t,s,a){"use strict";var i=!1,o=!1,r={},d=new Date,c=function(n){s.push(_(n)),e.clearNewSession(),o=!1},u=function(){for(var n=s.length-1;n>=0;n--)if(s[n].id===e.newSession.id){s[n]=e.newSession;break}e.clearNewSession(),o=!1},l=function(e){r=e.data,o=!1},f=function(){for(var n=s.length-1;n>=0;n--)if(s[n].id===e.newSession.id){s.splice(n,1);break}e.clearNewSession(),o=!1},g=function(e){msr.responseError(e),o=!1},m=function(){r={}},_=function(e){return e.starts_at=new Date(e.starts_at),e.starts_at_iso8601=new Date(e.starts_at_iso8601),e.ends_at=new Date(e.ends_at),e.ends_at_iso8601=new Date(e.ends_at_iso8601),e},w={name:null,description:null,starts_at_iso8601:null,ends_at_iso8601:null,hide_other_users_annotations:!1,hide_own_annotations:!1};e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy"],e.open={starts_at:!1,ends_at:!1},e.newSession=angular.copy(w),e.confirm=function(){return confirm.apply(window,arguments)},e.isEditing=function(){return i},e.isLoading=function(){return o},e.toggleEditing=function(){i=!i,i||e.clearNewSession()},e.openStartsAt=function(){e.open.starts_at=!0,e.open.ends_at=!1},e.openEndsAt=function(){e.open.ends_at=!0,e.open.starts_at=!1},e.hasError=function(e){return r.hasOwnProperty(e)},e.getError=function(n){if(e.hasError(n))return r[n][0]},e.hasSessions=function(){return s.length>0},e.getSessions=function(){return s},e.isActive=function(e){return e.starts_at_iso8601<d&&e.ends_at_iso8601>=d},e.dateComparator=function(e){return e.starts_at_iso8601.getTime()},e.submit=function(){m(),o=!0,e.newSession.starts_at=e.newSession.starts_at_iso8601,e.newSession.ends_at=e.newSession.ends_at_iso8601,e.newSession.id?n.save(e.newSession,u,l):n.create({transect_id:t},e.newSession,c,l)},e.deleteSession=function(){o=!0,n.delete({id:e.newSession.id},f,g)},e.clearNewSession=function(){m(),e.newSession=angular.copy(w)},e.editSession=function(n){e.newSession=angular.copy(n)},s.forEach(_)}]),angular.module("dias.transects.edit").controller("ImagesController",["$scope","$element","Image","TransectImage","TRANSECT_ID","msg",function(e,n,t,s,a,i){"use strict";var o={confirm:n.attr("data-confirmation"),success:n.attr("data-success")};e.data={addingNewImages:!1,filenames:"",newImages:[]};var r=function(n){var t=document.getElementById("transect-image-"+n);if(t)t.remove();else for(var s=e.data.newImages.length-1;s>=0;s--)if(e.data.newImages[s].id===n){e.data.newImages.splice(s,1);break}};e.deleteImage=function(e,n){var s=o.confirm.replace(":img","#"+e+" ("+n+")");confirm(s)&&t.delete({id:e},function(){r(e),i.success(o.success)},i.responseError)},window.$diasTransectsEditDeleteImage=function(n,t){e.$apply(function(){e.deleteImage(n,t)})},e.toggleAddingNewImage=function(){e.data.addingNewImages=!e.data.addingNewImages},e.addNewImages=function(){var n=s.save({transect_id:a},{images:e.data.filenames},function(){Array.prototype.push.apply(e.data.newImages,n),e.data.filenames=""},i.responseError)}}]);