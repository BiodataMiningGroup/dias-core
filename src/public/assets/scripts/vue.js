biigle.projects={},biigle.$viewModel("projects-dashboard-main",function(t){new Vue({el:t,components:{transectThumbnail:biigle.projects.components.transectThumbnail}})}),biigle.$viewModel("projects-show-transect-list",function(t){new Vue({el:t,data:{project:biigle.projects.project,transects:biigle.projects.transects,editing:!1,loading:!1},components:{transectThumbnail:biigle.projects.components.transectThumbnail},methods:{removeTransect:function(t){var i=this;this.startLoading(),biigle.api.projectTransects.detach({pid:this.project.id,id:t}).then(function(e){i.spliceTransect(t)},function(e){400===e.status?confirm("The transect you are about to remove belongs only to this project and will be deleted. Are you sure you want to delete this transect?")&&i.forceRemoveTransect(t):biigle.messages.store.handleErrorResponse(e)}).finally(this.quitLoading)},forceRemoveTransect:function(t){var i=this;this.startLoading(),biigle.api.projectTransects.detach({pid:this.project.id,id:t},{force:!0}).then(function(e){i.spliceTransect(t)},biigle.messages.store.handleErrorResponse).finally(this.quitLoading)},spliceTransect:function(t){for(var i=this.transects.length-1;i>=0;i--)this.transects[i].id===t&&this.transects.splice(i,1)},edit:function(){this.editing=!this.editing},startLoading:function(){this.loading=!0},quitLoading:function(){this.loading=!1}}})}),biigle.api.transectSample=Vue.resource("/api/v1/transects{/id}/sample{/number}"),biigle.projects.components={},biigle.projects.components.transectThumbnail={template:'<figure class="transect-thumbnail" v-bind:class="{loading: loading}" v-on:mouseover="fetchUuids" v-on:mousemove="updateIndex($event)" v-on:click="clearTimeout" v-on:mouseout="clearTimeout"><span class="transect-thumbnail__close close" v-if="removable" v-on:click.prevent="remove" v-bind:title="removeTitle">&times;</span><slot></slot><div class="transect-thumbnail__images" v-if="initialized"><img v-on:error="failed[i] = true" v-bind:class="{hidden: thumbHidden(i)}" v-bind:src="thumbUri(uuid)" v-for="(uuid, i) in uuids"></div><slot name="caption"></slot><span class="transect-thumbnail__progress" v-bind:style="{width: progress}"></span></figure>',props:{tid:{type:Number,required:!0},uri:{type:String,required:!0},format:{type:String,required:!0},removable:{type:Boolean,default:!1},removeTitle:{type:String,default:"Remove this transect"}},data:function(){return{uuids:[],initialized:!1,loading:!1,index:0,failed:[],timeoutId:null}},computed:{progress:function(){return this.initialized?100*this.index/(this.uuids.length-1)+"%":this.loading?"100%":"0%"}},methods:{fetchUuids:function(){if(!this.initialized&&!this.loading){var t=this;t.loading=!0,t.timeoutId=setTimeout(function(){biigle.api.transectSample.get({id:t.tid}).then(function(i){i.ok&&(t.uuids=i.data,t.initialized=!0)}).finally(function(){t.loading=!1})},1e3)}},thumbUri:function(t){return this.uri+"/"+t+"."+this.format},thumbHidden:function(t){return this.index!==t||this.failed[t]},updateIndex:function(t){var i=this.$el.getBoundingClientRect();this.index=Math.floor(this.uuids.length*(t.clientX-i.left)/i.width)},clearTimeout:function(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null,this.loading=!1)},remove:function(){this.clearTimeout(),this.$emit("remove",this.tid)}}};