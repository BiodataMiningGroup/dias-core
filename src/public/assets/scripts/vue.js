biigle.$viewModel("projects-dashboard-main",function(t){new Vue({el:t,components:{volumeThumbnail:biigle.$require("projects.components.volumeThumbnail")}})}),biigle.$viewModel("projects-show-volume-list",function(t){var e=biigle.$require("api.projectVolumes"),i=biigle.$require("api.attachableVolumes"),n=biigle.$require("messages.store");new Vue({el:t,data:{project:biigle.$require("projects.project"),volumes:biigle.$require("projects.volumes"),editing:!1,loading:!1,fetchedAttachableVolumes:!1,attachableVolumes:[],template:'<span v-text="item.name"></span>'},components:{volumeThumbnail:biigle.$require("projects.components.volumeThumbnail"),typeahead:VueStrap.typeahead},methods:{removeVolume:function(t){var i=this;this.startLoading(),e.detach({pid:this.project.id,id:t}).then(function(e){i.spliceVolume(t)},function(e){400===e.status?confirm("The volume you are about to remove belongs only to this project and will be deleted. Are you sure you want to delete this volume?")&&i.forceRemoveVolume(t):n.handleErrorResponse(e)}).finally(this.quitLoading)},forceRemoveVolume:function(t){var i=this;this.startLoading(),e.detach({pid:this.project.id,id:t},{force:!0}).then(function(e){i.spliceVolume(t)},n.handleErrorResponse).finally(this.quitLoading)},spliceVolume:function(t){for(var e=this.volumes.length-1;e>=0;e--)this.volumes[e].id===t&&(this.attachableVolumes.unshift(this.volumes[e]),this.volumes.splice(e,1))},edit:function(){this.editing=!this.editing,this.fetchedAttachableVolumes||(this.fetchedAttachableVolumes=!0,this.fetchAttachableVolumes())},startLoading:function(){this.loading=!0},quitLoading:function(){this.loading=!1},hasVolume:function(t){for(var e=this.volumes.length-1;e>=0;e--)if(this.volumes[e].id===t)return!0;return!1},attachVolume:function(t,i){if(i.reset(),t&&!this.hasVolume(t.id)){var s=this;this.startLoading(),e.attach({pid:this.project.id,id:t.id},{}).then(function(){s.volumes.unshift(t);for(var e=s.attachableVolumes.length-1;e>=0;e--)s.attachableVolumes[e].id===t.id&&s.attachableVolumes.splice(e,1)},n.handleErrorResponse).finally(this.quitLoading)}},fetchAttachableVolumes:function(){var t=this;i.get({id:this.project.id}).then(function(e){t.attachableVolumes=e.data},n.handleErrorResponse)}}})}),biigle.$component("projects.components.volumeThumbnail",{template:'<figure class="volume-thumbnail" v-bind:class="{loading: loading}" v-on:mouseover="fetchUuids" v-on:mousemove="updateIndex($event)" v-on:click="clearTimeout" v-on:mouseout="clearTimeout"><span class="volume-thumbnail__close close" v-if="removable" v-on:click.prevent="remove" v-bind:title="removeTitle">&times;</span><slot></slot><div class="volume-thumbnail__images" v-if="initialized"><img v-on:error="failed[i] = true" v-bind:class="{hidden: thumbHidden(i)}" v-bind:src="thumbUri(uuid)" v-for="(uuid, i) in uuids"></div><slot name="caption"></slot><span class="volume-thumbnail__progress" v-bind:style="{width: progress}"></span></figure>',props:{tid:{type:Number,required:!0},uri:{type:String,required:!0},format:{type:String,required:!0},removable:{type:Boolean,default:!1},removeTitle:{type:String,default:"Remove this volume"}},data:function(){return{uuids:[],initialized:!1,loading:!1,index:0,failed:[],timeoutId:null}},computed:{progress:function(){return this.initialized?100*this.index/(this.uuids.length-1)+"%":this.loading?"100%":"0%"}},methods:{fetchUuids:function(){if(!this.initialized&&!this.loading){var t=biigle.$require("api.volumeSample"),e=this;e.loading=!0,e.timeoutId=setTimeout(function(){t.get({id:e.tid}).then(function(t){t.ok&&(e.uuids=t.data,e.initialized=!0)}).finally(function(){e.loading=!1})},1e3)}},thumbUri:function(t){return this.uri+"/"+t+"."+this.format},thumbHidden:function(t){return this.index!==t||this.failed[t]},updateIndex:function(t){var e=this.$el.getBoundingClientRect();this.index=Math.floor(this.uuids.length*(t.clientX-e.left)/e.width)},clearTimeout:function(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null,this.loading=!1)},remove:function(){this.clearTimeout(),this.$emit("remove",this.tid)}}}),biigle.$declare("api.attachableVolumes",Vue.resource("/api/v1/projects{/id}/attachable-volumes")),biigle.$declare("api.volumeSample",Vue.resource("/api/v1/volumes{/id}/sample{/number}"));
