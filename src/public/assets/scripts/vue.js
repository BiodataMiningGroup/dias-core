biigle.$viewModel("projects-dashboard-main",function(t){new Vue({el:t,components:{transectThumbnail:biigle.$require("projects.components.transectThumbnail")}})}),biigle.$viewModel("projects-show-transect-list",function(t){var e=biigle.$require("api.projectTransects"),i=biigle.$require("api.attachableTransects"),n=biigle.$require("messages.store");new Vue({el:t,data:{project:biigle.$require("projects.project"),transects:biigle.$require("projects.transects"),editing:!1,loading:!1,fetchedAttachableTransects:!1,attachableTransects:[],template:'<span v-text="item.name"></span>'},components:{transectThumbnail:biigle.$require("projects.components.transectThumbnail"),typeahead:VueStrap.typeahead},methods:{removeTransect:function(t){var i=this;this.startLoading(),e.detach({pid:this.project.id,id:t}).then(function(e){i.spliceTransect(t)},function(e){400===e.status?confirm("The transect you are about to remove belongs only to this project and will be deleted. Are you sure you want to delete this transect?")&&i.forceRemoveTransect(t):n.handleErrorResponse(e)}).finally(this.quitLoading)},forceRemoveTransect:function(t){var i=this;this.startLoading(),e.detach({pid:this.project.id,id:t},{force:!0}).then(function(e){i.spliceTransect(t)},n.handleErrorResponse).finally(this.quitLoading)},spliceTransect:function(t){for(var e=this.transects.length-1;e>=0;e--)this.transects[e].id===t&&(this.attachableTransects.unshift(this.transects[e]),this.transects.splice(e,1))},edit:function(){this.editing=!this.editing,this.fetchedAttachableTransects||(this.fetchedAttachableTransects=!0,this.fetchAttachableTransects())},startLoading:function(){this.loading=!0},quitLoading:function(){this.loading=!1},hasTransect:function(t){for(var e=this.transects.length-1;e>=0;e--)if(this.transects[e].id===t)return!0;return!1},attachTransect:function(t,i){if(i.reset(),t&&!this.hasTransect(t.id)){var s=this;this.startLoading(),e.attach({pid:this.project.id,id:t.id},{}).then(function(){s.transects.unshift(t);for(var e=s.attachableTransects.length-1;e>=0;e--)s.attachableTransects[e].id===t.id&&s.attachableTransects.splice(e,1)},n.handleErrorResponse).finally(this.quitLoading)}},fetchAttachableTransects:function(){var t=this;i.get({id:this.project.id}).then(function(e){t.attachableTransects=e.data},n.handleErrorResponse)}}})}),biigle.$component("projects.components.transectThumbnail",{template:'<figure class="transect-thumbnail" v-bind:class="{loading: loading}" v-on:mouseover="fetchUuids" v-on:mousemove="updateIndex($event)" v-on:click="clearTimeout" v-on:mouseout="clearTimeout"><span class="transect-thumbnail__close close" v-if="removable" v-on:click.prevent="remove" v-bind:title="removeTitle">&times;</span><slot></slot><div class="transect-thumbnail__images" v-if="initialized"><img v-on:error="failed[i] = true" v-bind:class="{hidden: thumbHidden(i)}" v-bind:src="thumbUri(uuid)" v-for="(uuid, i) in uuids"></div><slot name="caption"></slot><span class="transect-thumbnail__progress" v-bind:style="{width: progress}"></span></figure>',props:{tid:{type:Number,required:!0},uri:{type:String,required:!0},format:{type:String,required:!0},removable:{type:Boolean,default:!1},removeTitle:{type:String,default:"Remove this transect"}},data:function(){return{uuids:[],initialized:!1,loading:!1,index:0,failed:[],timeoutId:null}},computed:{progress:function(){return this.initialized?100*this.index/(this.uuids.length-1)+"%":this.loading?"100%":"0%"}},methods:{fetchUuids:function(){if(!this.initialized&&!this.loading){var t=biigle.$require("api.transectSample"),e=this;e.loading=!0,e.timeoutId=setTimeout(function(){t.get({id:e.tid}).then(function(t){t.ok&&(e.uuids=t.data,e.initialized=!0)}).finally(function(){e.loading=!1})},1e3)}},thumbUri:function(t){return this.uri+"/"+t+"."+this.format},thumbHidden:function(t){return this.index!==t||this.failed[t]},updateIndex:function(t){var e=this.$el.getBoundingClientRect();this.index=Math.floor(this.uuids.length*(t.clientX-e.left)/e.width)},clearTimeout:function(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null,this.loading=!1)},remove:function(){this.clearTimeout(),this.$emit("remove",this.tid)}}}),biigle.$declare("api.attachableTransects",Vue.resource("/api/v1/projects{/id}/attachable-transects")),biigle.$declare("api.transectSample",Vue.resource("/api/v1/transects{/id}/sample{/number}"));