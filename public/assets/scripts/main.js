angular.module("biigle.api",["ngResource"]),angular.module("biigle.api").config(["$httpProvider","$compileProvider",function(e,i){"use strict";e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",i.debugInfoEnabled(!1)}]),angular.module("biigle.ui.messages",["ui.bootstrap"]),angular.module("biigle.ui.messages").config(["$compileProvider",function(e){e.debugInfoEnabled(!1)}]),angular.element(document).ready(function(){"use strict";angular.bootstrap(document.querySelector('[data-ng-controller="MessagesController"]'),["biigle.ui.messages"])}),angular.module("biigle.ui.users",["ui.bootstrap","biigle.api"]),angular.module("biigle.ui.users").config(["$compileProvider",function(e){"use strict";e.debugInfoEnabled(!1)}]),angular.module("biigle.ui.utils",[]),angular.module("biigle.ui.utils").config(["$compileProvider","$locationProvider",function(e,i){"use strict";e.debugInfoEnabled(!1),i.html5Mode({enabled:!0,requireBase:!1,rewriteLinks:!1})}]),angular.module("biigle.ui",["ui.bootstrap","biigle.ui.messages","biigle.ui.users","biigle.ui.utils","ngAnimate"]),angular.module("biigle.ui").config(["$compileProvider","$animateProvider",function(e,i){"use strict";e.debugInfoEnabled(!1),i.classNameFilter(/\banimated\b/)}]),biigle={},biigle.$viewModel=function(e,i){window.addEventListener("load",function(){var t=document.getElementById(e);t&&i(t)})},biigle.$require=function(e){e=Array.isArray(e)?e:e.split(".");for(var i=biigle,t=0,r=e.length;t<r;t++)i[e[t]]=i[e[t]]||{},i=i[e[t]];return i},biigle.$declare=function(e,i){e=e.split(".");var t=e.pop(),r=biigle.$require(e);return r[t]="function"==typeof i?i():i,i},biigle.$component=function(e,i){var t=biigle.$require(e);"function"==typeof i&&(i=i());for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r]);return t},angular.module("biigle.api").factory("Annotation",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/annotations/:id",{id:"@id"},{save:{method:"PUT"},query:{method:"GET",url:i+"/api/v1/images/:id/annotations",isArray:!0},add:{method:"POST",url:i+"/api/v1/images/:id/annotations"}})}]),angular.module("biigle.api").factory("AnnotationLabel",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/annotation-labels/:id",{id:"@id",annotation_id:"@annotation_id"},{query:{method:"GET",url:i+"/api/v1/annotations/:annotation_id/labels",isArray:!0},attach:{method:"POST",url:i+"/api/v1/annotations/:annotation_id/labels"},save:{method:"PUT",params:{annotation_id:null}},delete:{method:"DELETE",params:{annotation_id:null}}})}]),angular.module("biigle.api").factory("AnnotationSession",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/annotation-sessions/:id",{id:"@id"},{save:{method:"PUT"},query:{method:"GET",url:i+"/api/v1/transects/:transect_id/annotation-sessions",isArray:!0},create:{method:"POST",url:i+"/api/v1/transects/:transect_id/annotation-sessions"}})}]),angular.module("biigle.api").factory("Image",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/images/:id",{id:"@id"})}]),angular.module("biigle.api").factory("ImageLabel",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/image-labels/:id",{id:"@id",image_id:"@image_id"},{query:{method:"GET",url:i+"/api/v1/images/:image_id/labels",isArray:!0},attach:{method:"POST",url:i+"/api/v1/images/:image_id/labels"},delete:{method:"DELETE",params:{image_id:null}}})}]),angular.module("biigle.api").factory("Label",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/labels/:id",{id:"@id"},{create:{method:"POST",url:i+"/api/v1/label-trees/:label_tree_id/labels",params:{label_tree_id:"@label_tree_id"},isArray:!0}})}]),angular.module("biigle.api").factory("LabelSource",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/label-sources/:id/find")}]),angular.module("biigle.api").factory("LabelTree",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/label-trees/:id",{id:"@id"},{query:{method:"GET",isArray:!0},create:{method:"POST"},update:{method:"PUT"}})}]),angular.module("biigle.api").factory("LabelTreeAuthorizedProject",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/label-trees/:id/authorized-projects",{},{addAuthorized:{method:"POST"},removeAuthorized:{method:"DELETE",url:i+"/api/v1/label-trees/:id/authorized-projects/:pid",params:{pid:"@id"}}})}]),angular.module("biigle.api").factory("LabelTreeUser",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/label-trees/:label_tree_id/users/:id",{id:"@id"},{update:{method:"PUT"},attach:{method:"POST",url:i+"/api/v1/label-trees/:label_tree_id/users",params:{id:null}},detach:{method:"DELETE"}})}]),angular.module("biigle.api").factory("MediaType",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/media-types/:id",{id:"@id"})}]),angular.module("biigle.api").factory("OwnUser",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/users/my",{},{save:{method:"PUT"}})}]),angular.module("biigle.api").factory("Project",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/projects/:id",{id:"@id"},{query:{method:"GET",params:{id:"my"},isArray:!0},add:{method:"POST"},save:{method:"PUT"}})}]),angular.module("biigle.api").factory("ProjectLabelTree",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/projects/:project_id/label-trees",{project_id:"@project_id"},{available:{method:"GET",isArray:!0,url:i+"/api/v1/projects/:project_id/label-trees/available"},attach:{method:"POST",url:i+"/api/v1/projects/:project_id/label-trees"},detach:{method:"DELETE",url:i+"/api/v1/projects/:project_id/label-trees/:id",params:{id:"@id"}}})}]),angular.module("biigle.api").factory("ProjectTransect",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/projects/:project_id/transects/:id",{id:"@id"},{add:{method:"POST"},attach:{method:"POST"},detach:{method:"DELETE"}})}]),angular.module("biigle.api").factory("ProjectUser",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/projects/:project_id/users/:id",{id:"@id"},{save:{method:"PUT"},attach:{method:"POST"},detach:{method:"DELETE"}})}]),angular.module("biigle.api").factory("Role",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/roles/:id",{id:"@id"})}]),angular.module("biigle.api").factory("Shape",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/shapes/:id",{id:"@id"})}]),angular.module("biigle.api").factory("Transect",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/transects/:id",{id:"@id"},{save:{method:"PUT"}})}]),angular.module("biigle.api").factory("TransectImage",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/transects/:transect_id/images",{},{save:{method:"POST",isArray:!0}})}]),angular.module("biigle.api").factory("User",["$resource","URL",function(e,i){"use strict";return e(i+"/api/v1/users/:id/:query",{id:"@id"},{save:{method:"PUT"},add:{method:"POST"},find:{method:"GET",params:{id:"find"},isArray:!0}})}]),biigle.$viewModel("messages-display",function(e){var i=biigle.$require("messages.store"),t={props:["message"],computed:{typeClass:function(){return this.message.type?"alert-"+this.message.type:"alert-info"}},methods:{close:function(){this.message?i.close(this.message.id):this.$el.remove()}}};new Vue({el:e,components:{message:t},data:{messages:i.all}})}),biigle.$declare("messages.store",new Vue({data:{max:1,all:[]},methods:{post:function(e,i){biigle.$require("utils.cb").exitFullscreen(),this.all.unshift({id:Date.now(),type:e,text:i}),this.all.length>this.max&&this.all.pop()},danger:function(e){this.post("danger",e)},warning:function(e){this.post("warning",e)},success:function(e){this.post("success",e)},info:function(e){this.post("info",e)},close:function(e){for(var i=this.all.length-1;i>=0;i--)this.all[i].id===e&&this.all.splice(i,1)},handleErrorResponse:function(e){var i=e.body;if(i){if(i.message)return void this.danger(i.message);if("string"==typeof i)return void this.danger(i)}if(422===e.status)for(var t in i)this.danger(i[t][0]);else 403===e.status?this.danger("You have no permission to do that."):401===e.status?this.danger("Please log in (again)."):this.danger("The server didn't respond, sorry.")}}})),$biiglePostMessage=biigle.$require("messages.store.post"),angular.module("biigle.api").service("roles",["Role",function(e){"use strict";var i={},t={};e.query(function(e){e.forEach(function(e){i[e.id]=e.name,t[e.name]=e.id})}),this.getName=function(e){return i[e]},this.getId=function(e){return t[e]}}]),angular.module("biigle.api").service("shapes",["Shape",function(e){"use strict";var i={},t={},r=e.query(function(e){e.forEach(function(e){i[e.id]=e.name,t[e.name]=e.id})});this.getName=function(e){return i[e]},this.getId=function(e){return t[e]},this.getAll=function(){return r}}]),biigle.$viewModel("system-messages-edit-form",function(e){var i=e.querySelector('textarea[name="body"]'),t="";i&&(t=i.value,i.innerHTML=""),new Vue({el:e,data:{body:t}})}),biigle.$declare("api.notifications",Vue.resource("/api/v1/notifications{/id}",{},{markRead:{method:"PUT"}})),biigle.$declare("api.projectTransects",Vue.resource("/api/v1/projects{/pid}/transects{/id}",{},{attach:{method:"POST"},detach:{method:"DELETE"}})),biigle.$declare("api.projects",Vue.resource("/api/v1/projects{/id}",{},{query:{method:"GET",params:{id:"my"}}})),biigle.$viewModel("notifications-list",function(e){var i=biigle.$require("api.notifications"),t=biigle.$require("notifications.store"),r=biigle.$require("messages.store"),a={props:["item","removeItem"],data:function(){return{isLoading:!1}},computed:{classObject:function(){return this.item.data.type?"panel-"+this.item.data.type:"panel-default"},isUnread:function(){return null===this.item.read_at}},methods:{markRead:function(e){var a=this;this.isLoading=!0,i.markRead({id:this.item.id},{}).then(function(e){a.item.read_at=new Date,a.removeItem&&t.remove(a.item.id)},function(i){e||r.handleErrorResponse(i)}).finally(function(){a.isLoading=!1})}}};new Vue({el:e,components:{notification:a},data:{notifications:t.all},methods:{hasNotifications:function(){return t.count()>0}}})}),biigle.$viewModel("notifications-navbar-indicator",function(e){var i=biigle.$require("notifications.store");new Vue({el:e,computed:{unread:function(){return i.isInitialized()?i.hasUnread():"true"===this.$el.attributes.unread.value}}})}),biigle.$declare("notifications.store",new Vue({data:{_all:null,initialized:!1},computed:{all:{get:function(){return this._all||[]},set:function(e){this.initialized=!0,this._all=e}},unread:function(){return this.all.filter(function(e){return null===e.read_at})}},methods:{isInitialized:function(){return this.initialized},count:function(){return this.all.length},countUnread:function(){return this.unread.length},hasUnread:function(){for(var e=this.all.length-1;e>=0;e--)if(null===this.all[e].read_at)return!0;return!1},remove:function(e){for(var i=this.all.length-1;i>=0;i--)this.all[i].id===e&&this.all.splice(i,1)}}})),biigle.$viewModel("notifications-unread-count",function(e){var i=biigle.$require("notifications.store");new Vue({el:e,computed:{count:i.countUnread}})}),biigle.$declare("utils.cb",{exitFullscreen:function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}}),angular.module("biigle.ui.messages").service("msg",function(){"use strict";var e=this;this.post=function(e,i){i=i||e,window.$biiglePostMessage(e,i)},this.danger=function(i){e.post("danger",i)},this.warning=function(i){e.post("warning",i)},this.success=function(i){e.post("success",i)},this.info=function(i){e.post("info",i)},this.responseError=function(i){var t=i.data;if(t)if(t.message)e.danger(t.message);else if("string"==typeof t)e.danger(t);else for(var r in t)e.danger(t[r][0]);else 403===i.status?e.danger("You have no permission to do that."):401===i.status?e.danger("Please log in (again)."):e.danger("The server didn't respond, sorry.")}}),angular.module("biigle.ui.utils").factory("debounce",["$timeout","$q",function(e,i){"use strict";var t={};return function(r,a,n){var o=i.defer();return function(){var s=this,u=arguments,l=function(){t[n]=void 0,o.resolve(r.apply(s,u)),o=i.defer()};return t[n]&&e.cancel(t[n]),t[n]=e(l,a),o.promise}()}}]),angular.module("biigle.ui.utils").factory("filterExclude",function(){"use strict";var e=function(e,i){return e-i},i=function(i,t,r){r||(t=t.slice(0).sort(e));for(var a=i.slice(0).sort(e),n=0,o=0;n<t.length&&o<a.length;)t[n]<a[o]?n++:t[n]===a[o]?(i.splice(i.indexOf(a[o]),1),n++,o++):o++};return i}),angular.module("biigle.ui.utils").factory("filterSubset",function(){"use strict";var e=function(e,i){return e-i},i=function(i,t,r){r||(t=t.slice(0).sort(e));for(var a=i.slice(0).sort(e),n=[],o=0,s=0;o<t.length&&s<a.length;)t[o]<a[s]?o++:t[o]===a[s]?(o++,s++):n.push(a[s++]);for(;s<a.length;)n.push(a[s++]);for(o=0;o<n.length;o++)i.splice(i.indexOf(n[o]),1)};return i}),angular.module("biigle.ui.utils").service("keyboard",["$document",function(e){"use strict";var i={},t=e[0].body,r=function(e,i){for(var t=e.length-1;t>=0;t--)if(e[t].callback(i)===!1)return},a=function(e){if(e.target===t){var a=e.keyCode,n=String.fromCharCode(e.which||a).toLowerCase();i[a]&&r(i[a],e),i[n]&&r(i[n],e)}};e.bind("keydown",a),this.on=function(e,t,r){("string"==typeof e||e instanceof String)&&(e=e.toLowerCase()),r=r||0;var a={callback:t,priority:r};if(i[e]){var n,o=i[e];for(n=0;n<o.length&&!(o[n].priority>=r);n++);n===o.length-1?o.push(a):o.splice(n,0,a)}else i[e]=[a]},this.off=function(e,t){if(("string"==typeof e||e instanceof String)&&(e=e.toLowerCase()),i[e])for(var r=i[e],a=0;a<r.length;a++)if(r[a].callback===t){r.splice(a,1);break}}}]),angular.module("biigle.ui.utils").service("urlParams",["$location",function(e){"use strict";this.setSlug=function(i){var t=e.path();t=t.substring(0,t.lastIndexOf("/")),e.path(t+"/"+i),e.replace()},this.set=function(i){e.search(i),e.replace()},this.unset=function(i){e.search(i,null),e.replace()},this.get=function(i){return e.search()[i]}}]),angular.module("biigle.ui.users").directive("userChooser",function(){"use strict";return{restrict:"A",scope:{select:"=userChooser"},replace:!0,template:'<input type="text" data-ng-model="selected" data-uib-typeahead="name(user) for user in find($viewValue)" data-typeahead-wait-ms="250" data-typeahead-on-select="select($item)"/>',controller:["$scope","User",function(e,i){e.name=function(e){return e&&e.firstname&&e.lastname?e.firstname+" "+e.lastname:""},e.find=function(e){return i.find({query:encodeURIComponent(e)}).$promise}}]}});