biigle={},biigle.$viewModel=function(t,e){window.addEventListener("load",function(){var i=document.getElementById(t);i&&e(i)})},biigle.$require=function(t){t=Array.isArray(t)?t:t.split(".");for(var e=biigle,i=0,n=t.length;i<n;i++)e.hasOwnProperty(t[i])||(e[t[i]]={}),e=e[t[i]];return e},biigle.$declare=function(t,e){t=t.split(".");var i=t.pop();return biigle.$require(t)[i]="function"==typeof e?e():e,e},biigle.$component=function(t,e){var i=biigle.$require(t);"function"==typeof e&&(e=e());for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return i},biigle.$viewModel("video-container",function(t){var e=biigle.$require("videoSrc");new Vue({el:t,components:{videoScreen:biigle.$require("components.videoScreen"),videoTimeline:biigle.$require("components.videoTimeline")},data:{video:document.createElement("video")},computed:{},methods:{seek:function(t){this.video.currentTime=t}},created:function(){this.video.muted=!0},mounted:function(){this.video.src=e}})}),biigle.$component("components.controlButton",{template:'<span class="control-button btn" :title="title" :class="classObject" @click="handleClick" @mouseenter="handleMouseEnter" @mouseleave="handleMouseLeave"><i :class="iconClass" aria-hidden="true"></i><span v-if="hasSubControls" @click.stop class="control-button__sub-controls btn-group"><slot></slot></span></span>',props:{title:{type:String,default:""},icon:{type:String,required:!0},active:{type:Boolean,default:!1}},data:function(){return{mouseOver:!1,timeout:null,activeSubControls:0}},computed:{classObject:function(){return{active:this.active,"control-button--open":this.showSubControls}},iconClass:function(){return this.icon.startsWith("fa-")?"fa "+this.icon:"icon icon-white "+this.icon},hasSubControls:function(){return this.$slots.hasOwnProperty("default")},showSubControls:function(){return this.mouseOver||this.hasActiveSubControl},hasActiveSubControl:function(){return this.activeSubControls>0}},methods:{handleClick:function(){this.$emit("click")},handleMouseEnter:function(){this.mouseOver=!0,window.clearTimeout(this.timeout)},handleMouseLeave:function(){var t=this;window.clearTimeout(this.timeout),this.timeout=window.setTimeout(function(){t.mouseOver=!1},200)},updateActiveSubControls:function(t){t?this.activeSubControls++:this.activeSubControls--}},watch:{active:function(t){this.$parent.$emit("control-button-active",t)}},created:function(){this.$on("control-button-active",this.updateActiveSubControls)}}),biigle.$component("components.currentTimeIndicator",{template:'<span class="time-indicator" :style="style"></span>',props:{duration:{type:Number,required:!0},currentTime:{type:Number,required:!0}},data:function(){return{parentWidth:0}},computed:{style:function(){if(this.duration>0){return"transform: translateX("+this.parentWidth*this.currentTime/this.duration+"px);"}}},methods:{updateParentWidth:function(){this.parentWidth=this.$el.parentElement.clientWidth}},mounted:function(){this.updateParentWidth()}}),biigle.$component("components.videoProgress",{template:'<div class="video-progress" @click="emitSeek"><span class="time-indicator" :style="indicatorStyle"></span></div>',props:{duration:{type:Number,required:!0},currentTime:{type:Number,required:!0}},data:function(){return{elementWidth:0}},computed:{indicatorStyle:function(){if(this.duration>0){return"transform: translateX("+this.elementWidth*this.currentTime/this.duration+"px);"}}},methods:{updateElementWidth:function(){this.elementWidth=this.$el.clientWidth},emitSeek:function(t){var e=(t.clientX-t.target.getBoundingClientRect().left)/this.elementWidth;this.$emit("seek",e*this.duration)}},mounted:function(){this.updateElementWidth(),window.addEventListener("resize",this.updateElementWidth)}}),biigle.$component("components.videoScreen",{template:'<div class="video-screen"><div class="controls"><div class="btn-group"><control-button v-if="playing" icon="fa-pause" title="Pause" v-on:click="pause"></control-button><control-button v-else icon="fa-play" title="Play" v-on:click="play"></control-button></div></div></div>',components:{controlButton:biigle.$require("components.controlButton")},props:{video:{type:HTMLVideoElement,required:!0}},data:function(){return{playing:!1,animationFrameId:null}},computed:{},methods:{createMap:function(){return new ol.Map({renderer:"canvas",interactions:ol.interaction.defaults({altShiftDragRotate:!1,doubleClickZoom:!1,keyboard:!1,shiftDragZoom:!1,pinchRotate:!1,pinchZoom:!1})})},createVideoLayer:function(){this.videoCanvas.width=this.video.videoWidth,this.videoCanvas.height=this.video.videoHeight;var t=[0,0,this.videoCanvas.width,this.videoCanvas.height],e=new ol.proj.Projection({code:"biigle-image",units:"pixels",extent:t});this.videoLayer=new ol.layer.Image({map:this.map,source:new ol.source.Canvas({canvas:this.videoCanvas,projection:this.projection,canvasExtent:t,canvasSize:[t[0],t[1]]})}),this.map.setView(new ol.View({projection:e,minResolution:.25,extent:t})),this.map.getView().fit(t)},renderVideo:function(){this.videoCanvasCtx.drawImage(this.video,0,0,this.video.videoWidth,this.video.videoHeight),this.map.render()},startRenderLoop:function(){this.renderVideo(),this.animationFrameId=window.requestAnimationFrame(this.startRenderLoop)},stopRenderLoop:function(){window.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null},setPlaying:function(){this.playing=!0},setPaused:function(){this.playing=!1},play:function(){this.video.play()},pause:function(){this.video.pause()}},watch:{playing:function(t){t&&!this.animationFrameId?this.startRenderLoop():t||this.stopRenderLoop()}},created:function(){this.map=this.createMap(),this.videoCanvas=document.createElement("canvas"),this.videoCanvasCtx=this.videoCanvas.getContext("2d"),this.video.addEventListener("loadedmetadata",this.createVideoLayer),this.video.addEventListener("play",this.setPlaying),this.video.addEventListener("pause",this.setPaused),this.video.addEventListener("seeked",this.renderVideo)},mounted:function(){this.map.setTarget(this.$el)}}),biigle.$component("components.videoTimeline",{template:'<div class="video-timeline"><div class="static-strip"><div class="current-time" v-text="currentTimeString"></div><div class="track-labels"></div></div><div class="scroll-strip"><video-progress :duration="duration"  :current-time="currentTime"  @seek="emitSeek"></video-progress><div class="annotation-tracks"></div></div></div>',components:{videoProgress:biigle.$require("components.videoProgress")},props:{video:{type:HTMLVideoElement,required:!0}},data:function(){return{animationFrameId:null,updateInterval:100,updateLastTime:Date.now(),currentTime:0,currentTimeDate:new Date(0),currentTimeString:"00:00:00.000",duration:0}},computed:{},methods:{startUpdateLoop:function(){var t=Date.now();t-this.updateLastTime>this.updateInterval&&(this.updateCurrentTime(),this.updateLastTime=t),this.animationFrameId=window.requestAnimationFrame(this.startUpdateLoop)},stopUpdateLoop:function(){this.updateCurrentTime(),window.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null},updateCurrentTime:function(){this.currentTime=this.video.currentTime,this.currentTimeDate.setTime(1e3*this.currentTime),this.currentTimeString=this.currentTimeDate.toISOString().split("T")[1].slice(0,-1)},setDuration:function(){this.duration=this.video.duration},emitSeek:function(t){this.$emit("seek",t)}},watch:{},created:function(){this.video.addEventListener("play",this.startUpdateLoop),this.video.addEventListener("pause",this.stopUpdateLoop),this.video.addEventListener("loadedmetadata",this.setDuration),this.video.addEventListener("seeked",this.updateCurrentTime)},mounted:function(){}});